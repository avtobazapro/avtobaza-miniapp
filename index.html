<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>–ê–≤—Ç–æ–ë–∞–∑–∞.PRO ‚Äî –ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä / –∑–∞–ø—á–∞—Å—Ç–∏</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Telegram WebApp JS -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      /* Telegram theme support (fallbacks) */
      --tg-bg: var(--tg-theme-bg-color, #0a0d14);
      --tg-text: var(--tg-theme-text-color, #e7e9ee);
      --tg-hint: var(--tg-theme-hint-color, rgba(231,233,238,.62));
      --tg-link: var(--tg-theme-link-color, #2aabee);

      --text-main: var(--tg-text);
      --text-soft: var(--tg-hint);
      --accent: var(--tg-link);
      --accent-2: #22d3ee;
      --error: #fb7185;

      --border-soft: rgba(148, 163, 184, 0.14);
      --border-input: rgba(148, 163, 184, 0.18);

      --shell-bg: rgba(16, 18, 26, 0.58);
      --shell-bg-2: rgba(20, 24, 38, 0.72);

      --glass: rgba(6, 10, 18, 0.42);
      --glass-2: rgba(6, 10, 18, 0.62);

      --input-bg: rgba(6, 10, 18, 0.50);
      --input-bg-focus: rgba(6, 10, 18, 0.78);

      --shadow-soft: 0 26px 80px rgba(0, 0, 0, 0.62);
      --shadow-tight: 0 12px 32px rgba(0, 0, 0, 0.48);

      /* will be set by JS to reduce jumps on mobile keyboard */
      --app-height: 100dvh;
    }

    *{
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui,
        "SF Pro Text", "SF Pro Display", "Segoe UI", sans-serif;
    }

    body{
      min-height: var(--app-height);
      height: var(--app-height);
      color: var(--text-main);
      padding: 18px 12px 24px;
      display: flex;
      justify-content: center;

      background:
        radial-gradient(1100px 640px at 18% 0%, rgba(42,171,238,.14), transparent 60%),
        radial-gradient(900px 560px at 88% 18%, rgba(34,211,238,.08), transparent 58%),
        radial-gradient(700px 500px at 50% 110%, rgba(148,163,184,.06), transparent 55%),
        linear-gradient(180deg, var(--tg-bg), #06070c 92%);
    }

    .shell{
      width: 100%;
      max-width: 580px;
      padding: 18px 16px 18px;
      border-radius: 28px;
      border: 1px solid var(--border-soft);
      box-shadow: var(--shadow-soft);
      background: linear-gradient(180deg, var(--shell-bg), var(--shell-bg-2));
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      position: relative;
      overflow: hidden;
    }

    .shell::before{
      content:"";
      position:absolute;
      inset:-2px;
      pointer-events:none;
      background:
        radial-gradient(700px 260px at 12% 0%, rgba(42,171,238,.12), transparent 55%),
        radial-gradient(560px 240px at 92% 0%, rgba(34,211,238,.08), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), transparent 22%),
        repeating-linear-gradient(
          135deg,
          rgba(255,255,255,.018) 0px,
          rgba(255,255,255,.018) 1px,
          transparent 1px,
          transparent 10px
        );
      opacity: .9;
    }

    .shell > *{ position: relative; z-index: 1; }

    @media (min-width: 768px){
      .shell{ padding: 24px 24px 24px; margin-top: 20px; }
    }

    .header{
      display:flex;
      flex-direction:column;
      gap:8px;
      margin-bottom:14px;
    }

    .brand-row{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }

    .logo-word{ display:flex; flex-direction:column; gap:3px; }

    .logo-main{
      font-weight: 760;
      letter-spacing: .14em;
      text-transform: uppercase;
      font-size: 13px;
      color: var(--accent);
      text-shadow: 0 0 18px rgba(42,171,238,.22);
    }

    .logo-sub{
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .18em;
      color: var(--text-soft);
    }

    .status-pill{
      padding: 4px 10px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      color: var(--text-soft);
      display:inline-flex;
      align-items:center;
      gap:6px;
      background: var(--glass);
      white-space:nowrap;
    }

    .status-pill-dot{
      width: 6px; height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34,197,94,.18);
    }

    .tagline{
      font-size: 13px;
      color: var(--text-soft);
      line-height: 1.5;
    }

    /* ---- Glass tabs (NO micro-animation) ---- */
    .tabs{
      display:flex;
      gap: 8px;
      margin-top: 12px;
      margin-bottom: 10px;
      padding: 6px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(6,10,18,.30);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
    }

    .tab{
      flex: 1 1 0;
      border: 1px solid rgba(148,163,184,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      color: rgba(231,233,238,.70);
      border-radius: 999px;
      padding: 9px 10px;
      font-size: 13px;
      cursor: pointer;
      box-shadow: 0 10px 20px rgba(0,0,0,.28);
    }

    .tab:hover{
      border-color: rgba(42,171,238,.25);
      color: rgba(231,233,238,.88);
    }

    .tab.active{
      border-color: rgba(42,171,238,.55);
      background:
        radial-gradient(520px 120px at 18% 0%, rgba(42,171,238,.16), transparent 55%),
        linear-gradient(180deg, rgba(22,26,40,.90), rgba(10,12,18,.86));
      color: rgba(231,233,238,.96);
      box-shadow: 0 14px 30px rgba(0,0,0,.45);
    }

    form{ display:flex; flex-direction:column; gap:10px; }

    .tab-panel{ display:none; flex-direction:column; gap:10px; margin-top: 6px; }
    .tab-panel.active{ display:flex; }

    .field-group{ display:flex; flex-direction:column; gap:4px; }

    label{ font-size: 12px; color: var(--text-soft); }

    input[type="text"], textarea{
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border-input);
      padding: 9px 12px;
      font-size: 13px;
      outline:none;
      background: var(--input-bg);
      color: var(--text-main);
    }

    input[type="text"]::placeholder, textarea::placeholder{
      color: rgba(231,233,238,.42);
    }

    textarea{
      border-radius: 16px;
      resize: vertical;
      min-height: 76px;
    }

    input:focus, textarea:focus{
      border-color: rgba(42,171,238,.62);
      background: var(--input-bg-focus);
      box-shadow: 0 0 0 4px rgba(42,171,238,.12);
    }

    .two-cols{ display:flex; gap:8px; }
    .two-cols .field-group{ flex: 1 1 0; }

    .fuel-options{ display:flex; flex-wrap:wrap; gap:8px; }

    /* ---- Glass chips ---- */
    .fuel-chip{
      padding: 7px 11px;
      font-size: 12px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.16);
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      color: rgba(231,233,238,.70);
      cursor: pointer;
      box-shadow: 0 10px 18px rgba(0,0,0,.26);
    }

    .fuel-chip:hover{
      border-color: rgba(42,171,238,.25);
      color: rgba(231,233,238,.90);
    }

    .fuel-chip.active{
      border-color: rgba(42,171,238,.65);
      background:
        radial-gradient(420px 120px at 20% 0%, rgba(42,171,238,.18), transparent 55%),
        linear-gradient(180deg, rgba(22,26,40,.90), rgba(10,12,18,.86));
      color: rgba(231,233,238,.96);
      box-shadow: 0 14px 26px rgba(0,0,0,.42);
    }

    .hint{
      font-size: 11px;
      color: rgba(231,233,238,.56);
    }

    /* ---- Glass submit button ---- */
    .btn{
      margin-top: 10px;
      width: 100%;
      border-radius: 999px;
      padding: 12px 12px;
      font-size: 13px;
      font-weight: 650;
      cursor: pointer;

      border: 1px solid rgba(42,171,238,.50);
      color: rgba(231,233,238,.96);
      background:
        radial-gradient(520px 120px at 18% 0%, rgba(42,171,238,.18), transparent 55%),
        linear-gradient(180deg, rgba(22,26,40,.92), rgba(10,12,18,.90));
      box-shadow: 0 16px 36px rgba(0,0,0,.58);

      position: relative;
      overflow: hidden;
    }

    .btn::after{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(500px 140px at 40% -10%, rgba(255,255,255,.10), transparent 60%);
      opacity: .65;
      pointer-events:none;
    }

    .btn:hover{
      box-shadow: 0 20px 44px rgba(0,0,0,.64);
      border-color: rgba(34,211,238,.55);
    }

    .btn:active{
      transform: translateY(1px);
      box-shadow: 0 12px 28px rgba(0,0,0,.58);
    }

    .form-message{
      margin-top: 6px;
      font-size: 11px;
      color: var(--text-soft);
      white-space: pre-line;
    }

    .form-message.error{ color: var(--error); }

    .footnote{
      margin-top: 14px;
      font-size: 11px;
      color: rgba(231,233,238,.56);
      line-height: 1.4;
    }
  </style>
</head>

<body>
  <div class="shell">
    <header class="header">
      <div class="brand-row">
        <div class="logo-word">
          <div class="logo-main">–ê–≤—Ç–æ–ë–∞–∑–∞.PRO</div>
          <div class="logo-sub">Korea ¬∑ Premium</div>
        </div>
        <div class="status-pill">
          <span class="status-pill-dot"></span>
          –ú–∏–Ω–∏-–∞–Ω–∫–µ—Ç–∞
        </div>
      </div>
      <p class="tagline">
        –ó–∞–∫–∞–∑ –∞–≤—Ç–æ –∏–∑ –Æ–∂–Ω–æ–π –ö–æ—Ä–µ–∏ | –ö–∏—Ç–∞—è | –ï–≤—Ä–æ–ø—ã |
        –í—ã–±–µ—Ä–∏—Ç–µ –≤–∫–ª–∞–¥–∫—É: –ü–æ–¥–±–æ—Ä –ê–≤—Ç–æ –∏–ª–∏ –ê–≤—Ç–æ –∑–∞–ø—á–∞—Å—Ç–µ–π.
      </p>
    </header>

    <main>
      <div class="tabs">
        <button class="tab active" data-tab="car" type="button">–ü–æ–¥–±–æ—Ä –∞–≤—Ç–æ</button>
        <button class="tab" data-tab="parts" type="button">–ê–≤—Ç–æ –∑–∞–ø—á–∞—Å—Ç–∏</button>
      </div>

      <form id="leadForm">
        <!-- –í–∫–ª–∞–¥–∫–∞: –ü–æ–¥–±–æ—Ä –∞–≤—Ç–æ (–≤—Å—ë –ù–ï–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) -->
        <div class="tab-panel active" id="tab-car">
          <div class="field-group">
            <label for="carBrand">–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å</label>
            <input type="text" id="carBrand" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Genesis GV80, Kia Carnival, BMW 520i" />
          </div>

          <div class="two-cols">
            <div class="field-group">
              <label for="carYear">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ (–æ—Ç / –¥–æ)</label>
              <input type="text" id="carYear" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –æ—Ç 2020 –∏–ª–∏ 2021‚Äì2023" />
            </div>
            <div class="field-group">
              <label for="carMileage">–ü—Ä–æ–±–µ–≥, –∫–º</label>
              <input type="text" id="carMileage" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥–æ 80 000 –∫–º" />
            </div>
          </div>

          <div class="field-group">
            <label>–¢–æ–ø–ª–∏–≤–æ</label>
            <div class="fuel-options" id="fuelOptions">
              <button type="button" class="fuel-chip active" data-fuel="–î–∏–∑–µ–ª—å">–î–∏–∑–µ–ª—å</button>
              <button type="button" class="fuel-chip" data-fuel="–ë–µ–Ω–∑–∏–Ω">–ë–µ–Ω–∑–∏–Ω</button>
              <button type="button" class="fuel-chip" data-fuel="–ì–∏–±—Ä–∏–¥">–ì–∏–±—Ä–∏–¥</button>
              <button type="button" class="fuel-chip" data-fuel="–≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞">–≠–ª–µ–∫—Ç—Ä–∏—á–∫–∞</button>
              <button type="button" class="fuel-chip" data-fuel="–ì–∞–∑">–ì–∞–∑</button>
            </div>
          </div>

          <div class="two-cols">
            <div class="field-group">
              <label for="carRegion">–†–µ–≥–∏–æ–Ω –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ</label>
              <input type="text" id="carRegion" placeholder="–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä, –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –¥—Ä—É–≥–æ–π" />
            </div>
            <div class="field-group">
              <label for="carPhone">–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏</label>
              <input type="text" id="carPhone" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +7 999 123-45-67" />
            </div>
          </div>

          <div class="field-group">
            <label for="carBudget">–ë—é–¥–∂–µ—Ç, ‚ÇΩ</label>
            <input type="text" id="carBudget" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¥–æ 3 500 000 ‚ÇΩ" />
          </div>

          <div class="field-group">
            <label for="carComment">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (VIN, –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—è, —Ü–≤–µ—Ç)</label>
            <textarea id="carComment" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ VIN (–µ—Å–ª–∏ –µ—Å—Ç—å), –∂–µ–ª–∞–µ–º—É—é –∫–æ–º–ø–ª–µ–∫—Ç–∞—Ü–∏—é, —Ü–≤–µ—Ç, —Å—Ä–æ–∫–∏‚Ä¶"></textarea>
            <div class="hint">
              –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —Ç–µ–ª–µ—Ñ–æ–Ω –∏–ª–∏ —É–¥–æ–±–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è —Å–≤—è–∑–∏ ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ Telegram –∏–ª–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.
            </div>
          </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∞: –ê–≤—Ç–æ –∑–∞–ø—á–∞—Å—Ç–∏ -->
        <div class="tab-panel" id="tab-parts">
          <div class="field-group">
            <label for="partsBrand">–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å –∞–≤—Ç–æ</label>
            <input type="text" id="partsBrand" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Kia Carnival 2.2D, Hyundai Solaris" />
          </div>

          <div class="two-cols">
            <div class="field-group">
              <label for="partsYear">–ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</label>
              <input type="text" id="partsYear" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 2023" />
            </div>
            <div class="field-group">
              <label for="partsVin">VIN (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
              <input type="text" id="partsVin" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: KNAM64..." />
            </div>
          </div>

          <div class="field-group">
            <label for="partsNeed">–ß—Ç–æ –Ω—É–∂–Ω–æ (–Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–∏ / —É–∑–ª–∞)</label>
            <input type="text" id="partsNeed" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ø–µ—Ä–µ–¥–Ω–∏–π –±–∞–º–ø–µ—Ä, –ª–µ–≤–∞—è —Ñ–∞—Ä–∞, –¥–≤–∏–≥–∞—Ç–µ–ª—å" />
          </div>

          <div class="field-group">
            <label for="partsNumber">–û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä / –∞—Ä—Ç–∏–∫—É–ª (–µ—Å–ª–∏ –µ—Å—Ç—å)</label>
            <input type="text" id="partsNumber" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 92101-S000, 28113-5H000" />
          </div>

          <div class="two-cols">
            <div class="field-group">
              <label for="partsRegion">–†–µ–≥–∏–æ–Ω / –≥–æ—Ä–æ–¥ –¥–æ—Å—Ç–∞–≤–∫–∏</label>
              <input type="text" id="partsRegion" placeholder="–ú–æ—Å–∫–≤–∞, –ö—Ä–∞—Å–Ω–æ–¥–∞—Ä, –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫, –¥—Ä—É–≥–æ–π" />
            </div>
            <div class="field-group">
              <label for="partsPhone">–¢–µ–ª–µ—Ñ–æ–Ω –¥–ª—è —Å–≤—è–∑–∏</label>
              <input type="text" id="partsPhone" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: +7 999 123-45-67" />
            </div>
          </div>

          <div class="field-group">
            <label for="partsComment">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ (—Ñ–æ—Ç–æ, —Å—Ä–æ—á–Ω–æ—Å—Ç—å, –ø–æ–∂–µ–ª–∞–Ω–∏—è)</label>
            <textarea id="partsComment" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –≤—Å—ë, —á—Ç–æ –≤–∞–∂–Ω–æ: —Å—Ç–æ—Ä–æ–Ω–∞, —Ü–≤–µ—Ç, –µ—Å—Ç—å –ª–∏ —Ñ–æ—Ç–æ –¥–µ—Ç–∞–ª–∏, —Å—Ä–æ—á–Ω–æ—Å—Ç—å‚Ä¶"></textarea>
            <div class="hint">–§–æ—Ç–æ –¥–µ—Ç–∞–ª–∏ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–∏—Å–ª–∞—Ç—å —É–∂–µ –≤ –¥–∏–∞–ª–æ–≥–µ —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º.</div>
          </div>
        </div>

        <button type="submit" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        <div id="formMessage" class="form-message"></div>
      </form>

      <p class="footnote">
        –û—Ç–ø—Ä–∞–≤–ª—è—è –∑–∞—è–≤–∫—É, –≤—ã —Å–æ–≥–ª–∞—à–∞–µ—Ç–µ—Å—å —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –≤–∞—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∏–ª–∏ –∑–∞–ø—á–∞—Å—Ç–µ–π –∏ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏.
        –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.
      </p>
    </main>
  </div>

  <script>
    const tg = window.Telegram?.WebApp;

    // 1) Fix "jump" when keyboard opens: use Telegram viewportStableHeight
    function setAppHeight() {
      // Telegram gives stable height in px (doesn't jump when keyboard appears)
      if (tg && typeof tg.viewportStableHeight === "number" && tg.viewportStableHeight > 0) {
        document.documentElement.style.setProperty("--app-height", tg.viewportStableHeight + "px");
      } else {
        // fallback for browsers
        document.documentElement.style.setProperty("--app-height", window.innerHeight + "px");
      }
    }

    if (tg) {
      // tg.expand();  // <- –º–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –≤—Å–µ–≥–¥–∞ –Ω–∞ –ø–æ–ª–Ω—ã–π —ç–∫—Ä–∞–Ω. –ò–Ω–æ–≥–¥–∞ –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —É—Å–∏–ª–∏–≤–∞–µ—Ç –æ—â—É—â–µ–Ω–∏–µ "–ø—Ä—ã–∂–∫–∞".
      tg.ready();

      setAppHeight();
      tg.onEvent("viewportChanged", setAppHeight);
    } else {
      setAppHeight();
      window.addEventListener("resize", setAppHeight);
    }

    const BOT_USERNAME = "abazaprosecbot";

    // Tabs (no animations)
    let activeTab = "car";
    const tabButtons = document.querySelectorAll(".tab");
    const tabPanels = {
      car: document.getElementById("tab-car"),
      parts: document.getElementById("tab-parts"),
    };

    const form = document.getElementById("leadForm");
    const formMessage = document.getElementById("formMessage");

    tabButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const tab = btn.dataset.tab;
        if (tab === activeTab) return;

        activeTab = tab;
        tabButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");

        Object.keys(tabPanels).forEach((key) => {
          tabPanels[key].classList.toggle("active", key === activeTab);
        });

        formMessage.textContent = "";
        formMessage.classList.remove("error");
      });
    });

    // Fuel select
    let selectedFuel = "–î–∏–∑–µ–ª—å";
    const fuelButtons = document.querySelectorAll(".fuel-chip");

    fuelButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        fuelButtons.forEach((b) => b.classList.remove("active"));
        btn.classList.add("active");
        selectedFuel = btn.dataset.fuel;
      });
    });

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      formMessage.textContent = "";
      formMessage.classList.remove("error");

      if (activeTab === "car") {
        await handleCarSubmit();
      } else {
        await handlePartsSubmit();
      }
    });

    async function handleCarSubmit() {
      const brand = document.getElementById("carBrand").value.trim();
      const year = document.getElementById("carYear").value.trim();
      const mileage = document.getElementById("carMileage").value.trim();
      const region = document.getElementById("carRegion").value.trim();
      const phone = document.getElementById("carPhone").value.trim();
      const budget = document.getElementById("carBudget").value.trim();
      const comment = document.getElementById("carComment").value.trim();

      if (!brand && !year && !mileage && !region && !phone && !budget && !comment) {
        formMessage.textContent =
          "–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –ø—É—Å—Ç—É—é —Ñ–æ—Ä–º—É, –Ω–æ –ª—É—á—à–µ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ üòä";
      }

      const payload = {
        source: "miniapp_avtobaza_form_car",
        type: "car",
        brand, year, mileage,
        fuel: selectedFuel,
        region, phone, budget, comment,
        createdAt: new Date().toISOString(),
      };

      const textPreview =
        "–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ–º–æ–±–∏–ª—è –∏–∑ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n\n" +
        (brand ? `–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å: ${brand}\n` : "") +
        (year ? `–ì–æ–¥: ${year}\n` : "") +
        (mileage ? `–ü—Ä–æ–±–µ–≥: ${mileage}\n` : "") +
        `–¢–æ–ø–ª–∏–≤–æ: ${selectedFuel}\n` +
        (region ? `–†–µ–≥–∏–æ–Ω –ø–æ–ª—É—á–µ–Ω–∏—è –∞–≤—Ç–æ: ${region}\n` : "") +
        (budget ? `–ë—é–¥–∂–µ—Ç: ${budget}\n` : "") +
        (phone ? `–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n` : "") +
        (comment ? `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}\n` : "");

      await sendPayload(payload, textPreview || "–ó–∞—è–≤–∫–∞ –Ω–∞ –ø–æ–¥–±–æ—Ä –∞–≤—Ç–æ (–∫–ª–∏–µ–Ω—Ç –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –ø–æ–ª—è).");
    }

    async function handlePartsSubmit() {
      const brand = document.getElementById("partsBrand").value.trim();
      const year = document.getElementById("partsYear").value.trim();
      const vin = document.getElementById("partsVin").value.trim();
      const need = document.getElementById("partsNeed").value.trim();
      const number = document.getElementById("partsNumber").value.trim();
      const region = document.getElementById("partsRegion").value.trim();
      const phone = document.getElementById("partsPhone").value.trim();
      const comment = document.getElementById("partsComment").value.trim();

      if (!brand && !year && !vin && !need && !number && !region && !phone && !comment) {
        formMessage.textContent =
          "–í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∏ –ø—É—Å—Ç—É—é —Ñ–æ—Ä–º—É, –Ω–æ –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –∑–∞–ø—á–∞—Å—Ç–µ–π –ª—É—á—à–µ —É–∫–∞–∑–∞—Ç—å —Ö–æ—Ç—è –±—ã –º–∞—Ä–∫—É –∞–≤—Ç–æ –∏–ª–∏ —á—Ç–æ –Ω—É–∂–Ω–æ üòä";
      }

      const payload = {
        source: "miniapp_avtobaza_form_parts",
        type: "parts",
        brand, year, vin, need, number, region, phone, comment,
        createdAt: new Date().toISOString(),
      };

      const textPreview =
        "–ó–∞—è–≤–∫–∞ –Ω–∞ –∞–≤—Ç–æ –∑–∞–ø—á–∞—Å—Ç–∏ –∏–∑ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:\n\n" +
        (brand ? `–ú–∞—Ä–∫–∞ –∏ –º–æ–¥–µ–ª—å –∞–≤—Ç–æ: ${brand}\n` : "") +
        (year ? `–ì–æ–¥: ${year}\n` : "") +
        (vin ? `VIN: ${vin}\n` : "") +
        (need ? `–ß—Ç–æ –Ω—É–∂–Ω–æ: ${need}\n` : "") +
        (number ? `–ù–æ–º–µ—Ä –¥–µ—Ç–∞–ª–∏ / –∞—Ä—Ç–∏–∫—É–ª: ${number}\n` : "") +
        (region ? `–†–µ–≥–∏–æ–Ω / –≥–æ—Ä–æ–¥: ${region}\n` : "") +
        (phone ? `–¢–µ–ª–µ—Ñ–æ–Ω: ${phone}\n` : "") +
        (comment ? `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${comment}\n` : "");

      await sendPayload(payload, textPreview || "–ó–∞—è–≤–∫–∞ –Ω–∞ –∞–≤—Ç–æ –∑–∞–ø—á–∞—Å—Ç–∏ (–∫–ª–∏–µ–Ω—Ç –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –ø–æ–ª—è).");
    }

    async function sendPayload(payload, textPreview) {
      try {
        const deepLink = "https://t.me/" + BOT_USERNAME + "?text=" + encodeURIComponent(textPreview);
        window.location.href = deepLink;

        formMessage.textContent =
          "–ú—ã –æ—Ç–∫—Ä—ã–ª–∏ —á–∞—Ç —Å @" + BOT_USERNAME +
          ". –ó–∞—è–≤–∫–∞ —É–∂–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ ‚Äî –æ—Å—Ç–∞–ª–æ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞–∂–∞—Ç—å ¬´–û—Ç–ø—Ä–∞–≤–∏—Ç—å¬ª.";

        form.reset();

        // reset fuel
        selectedFuel = "–î–∏–∑–µ–ª—å";
        fuelButtons.forEach((b) => b.classList.remove("active"));
        const firstFuel = document.querySelector('.fuel-chip[data-fuel="–î–∏–∑–µ–ª—å"]');
        if (firstFuel) firstFuel.classList.add("active");
      } catch (err) {
        console.error(err);
        formMessage.textContent =
          "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫—Ä—ã—Ç—å —á–∞—Ç. –û—Ç–∫—Ä–æ–π—Ç–µ @abazaprosecbot –≤—Ä—É—á–Ω—É—é –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –∑–∞—è–≤–∫—É –≤ —Å–≤–æ–±–æ–¥–Ω–æ–π —Ñ–æ—Ä–º–µ.";
        formMessage.classList.add("error");
      }
    }
  </script>
</body>
</html>
